<h1 class="mb-4">All Complaints</h1>

<% if params[:query].present? %>
  <p class="text-muted">Search results for: "<strong><%= params[:query] %></strong>"</p>
<% end %>

<%= form_with url: complains_path, method: :get, local: true, html: { id: "category_filter_form" } do %>
  <div class="row mb-3">
    <div class="col-md-4">
      <%= select_tag :category_id,
          options_from_collection_for_select(@categories, :id, :name, params[:category_id]),
          include_blank: "All Categories",
          class: "form-select",
          onchange: "document.getElementById('category_filter_form').submit();" %>
    </div>
  </div>
<% end %>


<table class="table table-hover">
  <thead class="table-light">
    <tr>
      <th>Title</th>
      <th>Source</th>
      <th>Category</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @complains.each do |complain| %>
      <tr>
        <td><%= complain.title %></td>
        <td><%= complain.source %></td>
        <td>
          <span class="badge bg-secondary"><%= complain.category&.name || "Uncategorized" %></span>
        </td>
        <td>
          <%= link_to 'Show', complain_path(complain), class: "btn btn-sm btn-info" %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
